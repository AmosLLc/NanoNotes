[TOC]

### Redis复制

复制能解决单点故障问题，是实现分布式系统高可用的基础。

#### 复制基础

参与复制的 Redis 实例分为主节点（master）和从节点（slave）。复制的数据流是单向的，只能由主节点到从节点。

默认情况下，Redis 实例都是主节点。

##### 1. 建立复制

配置方式：

- 在**配置文件**中加入 **slaveof {masterHost} {masterPort}** 随 Redis 启动生效。
- 在 Redis-server 启动命令后加入 --slaveof {masterHost} {masterPort} 生效。
- 直接使用**命令**：**slaveof {masterHost} {masterPort}** 生效。

slaveof 配置都是在**从节点发起**。

主从节点复制关系建立成功之后可以用 **info replication** 命令查看**复制相关状态**。

##### 2. 断开复制

在从节点执行 **slaveof no one** 断开主从复制关系。断开之后从节点变成主节点，但是原来同步的数据不会丢失。

**切换主节点**：如果从节点断开主从复制进而又把**另一个**节点当做主节点，则切换后从节点会**清空**之前同步的数据。

##### 3. 只读

默认情况下，从节点使用 **slave-read-only=yes** 配置为只读模式。生产环境这样做！因为对从节点的修改主节点是不知道的。



#### 复制拓扑关系

Redis 复制的拓扑关系可以支持**单层或多层**复制关系。根据复杂性可以分为一主一从、一主多从、树状主从结构。

##### 1. 一主一从结构

最简单的拓扑结构，用于主节点出现宕机时从节点提供故障转移支持。



#### 复制原理





