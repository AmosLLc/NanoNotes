[TOC]

### 动态与函数式编程面试题

#### Q：描述动态代理的几种实现方式？分别说出相应的优缺点

A：代理可以分为 "静态代理" 和 "动态代理"，动态代理又分为 "JDK 动态代理" 和 "CGLIB 动态代理" 实现。

① **静态代理**：代理对象和实际对象都继承了同一个接口，在代理对象中指向的是实际对象的实例，这样对外暴露的是代理对象而真正调用的是 Real Object。

- **优点**：可以很好的保护实际对象的业务逻辑对外暴露，从而提高安全性。
- **缺点**：不同的接口要有**不同的代理类实现**，会很冗余。接口一改全都得该。

② **JDK 动态代理**：

- 为了解决静态代理中，生成大量的**代理类造成的冗余**。
- JDK 动态代理只需要实现 **InvocationHandler** 接口，重写 **invoke** 方法便可以完成代理的实现。
- JDK 的代理是利用**反射生成代理类 Proxyxx.class** 代理类字节码，并生成对象。
- JDK 动态代理之所以**只能代理接口**是因为**代理类本身已经 extends 了 Proxy，而 Java 是不允许多重继承的**，但是允许实现多个接口。
- **优点**：解决了静态代理中冗余的代理实现类问题。
- **缺点**：JDK 动态代理是基于接口设计实现的，如果没有接口，会抛异常。

③ **CGLIB 代理**：

- 由于 JDK 动态代理限制了只能基于接口设计，而对于没有接口的情况，JDK方式解决不了；
- CGLib 采用了**非常底层**的字节码技术，其原理是通过字节码技术**为一个类创建子类**，并在子类中**采用方法拦截**的技术拦截所有父类方法的调用，顺势**织入横切逻辑**，来完成动态代理的实现。
- 实现方式实现 **MethodInterceptor** 接口，重写 **intercept** 方法，通过 **Enhancer** 类的**回调方法**来实现。
- 但是 CGLib在 创建代理对象时所**花费的时间却比 JDK 多得多**，所以对于**单例的对象**，因为无需频繁创建对象，用 CGLib 合适，反之，使用 JDK 方式要更为合适一些。
- 同时，由于 CGLib 由于是采用动态创建子类的方法，对于 **final 方法**，无法进行代理。
- **优点**：没有接口也能实现动态代理，而且采用字节码增强技术，性能也不错。
- **缺点**：技术实现相对难理解些。













