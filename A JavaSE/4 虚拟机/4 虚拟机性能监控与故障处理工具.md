[TOC]

### 虚拟机性能监控与故障处理工具

给一个系统定位问题的时候，知识、经验是关键基础，数据是依据。工具是运用知识处理数据的手段。这里说的数据包括：运行日志、异常堆栈、GC日志、线程快照文件（threaddump/javacore文件）、堆转储快照（heapdump/hprof文件）等。

#### JDK的命令行工具

JDK的命令行工具大多数是对 jdk/lib/tools.jar 类库的一层薄包装而已，它们的主要功能代码是在 tools 类库中实现的。Linux 下的这些工具有的甚至是用 shell 脚本编写的。
SUN JDK 监控和故障处理工具：

|  名称  |                           主要作用                           |
| :----: | :----------------------------------------------------------: |
|  jps   | Jvm Process Status Tool, 显示指定系统内所有的 HotSpot 虚拟机进程 |
| jstat  | Jvm Statistics Monitoring Tool, 用于收集 HotSpot 虚拟机各方面的运行数据 |
| jinfo  |       Configuration Info for Java，显示虚拟机配置信息        |
|  jmap  | Memory Map for Java,生成虚拟机的内存转储快照（heapdump文件） |
|  jhat  | Jvm Heap Dump Browser，用于分析 heapmap 文件，它会建立一个 http/html 服务器让用户可以在浏览器上查看分析结果 |
| jstack |         Stack Trace for Java , 显示虚拟机的线程快照          |

##### jps：虚拟机进程状况工具

以列出正在运行的**虚拟机进程**，并显示虚拟机执行主类名称以及这些进程的本地虚拟机唯一ID。

```java
jps命令格式 jps [options] [hostid]
```

jps 可以通过 RMI 协议开启了 RMI 服务的远程虚拟机进程状态，hostid 为 RMI 注册表中注册的主机名。



##### jstat：虚拟机统计信息监视工具

jstat是用于监视虚拟机各种**运行状态信息**的命令行工具。它可以显示本地或者远程虚拟机进程中的类装载、内存、垃圾回收、JIT编译等运行数据，在没有GUI图形界面，只是提供了纯文本控制台环境的服务器上，它将是运行期定位虚拟机性能问题的首选工具。

jstat 的命令格式：

```java
jstat [option vmid [interval [s|ms] [count]] ]
```



##### jmap：java内存映像工具

jmap 命令用于生成**堆转储快照**。jmap 的作用并不仅仅为了获取 dump 文件，它还可以查询 finalize 执行队列、Java 堆和永久代的详细信息。如空间使用率、当前用的是哪种收集器等。

jmap 的命令格式 

```java
jmap [option] vmid
```



##### jhat：虚拟机堆转储快照分析工具

Sun JDK 提供 jhat 与 jmap 搭配使用，来**分析 dump 生成的堆快照**。jhat 内置了一个微型的 HTTP/HTML 服务器，生成 dump 文件的分析结果后，可以在**浏览器**中查看。

用法举例: jhat test1.bin

test1.bin为生成的dump文件。


##### jstack：java堆栈跟踪工具

jstack 命令用于生成虚拟机当前时刻的**线程快照**（一般称为 threaddump 或者 javacore 文件）。线程快照就是当前虚拟机内每一条线程正在执行的**方法堆栈集合**，生成线程快照的主要目的是**定位线程出现长时间==停顿==的原因**，如线程死锁、死循环、请求外部资源导致长时间等待等。

jstack 命令格式 

```java
jstack [option] vmid
```



#### JDK 的可视化工具

JDK 中除了提供大量的命令行工具外，还有两个功能强大的可视化工具：JConsole 和 VisualVM。

##### JConsole

JConsole 工具在  JDK/bin 目录下，启动 JConsole 后，将自动搜索本机运行的 Jvm 进程，不需要 jps 命令来查询指定。双击其中一个 Jvm 进程即可开始监控，也可使用“远程进程”来连接远程服务器。

提供内存监控和线程监控的功能。

##### VisualVM：多合一故障处理工具

VisualVM 是一个集成多个 JDK 命令行工具的可视化工具。VisualVM 基于 NetBeans 平台开发，它具备了插件扩展功能的特性，通过插件的扩展，可用于显示虚拟机进程及进程的配置和环境信息(jps，jinfo)，监视应用程序的CPU、GC、堆、方法区及线程的信息(jstat、jstack)等。VisualVM 在 JDK/bin 目录下。

可以直接在生产环境使用。

- 生成、浏览堆转储快照。
- 分析程序性能。





**参考资料**

- 虚拟机性能监控与故障处理工具：http://blog.csdn.net/wsyw126/article/details/62422005

